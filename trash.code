def load_image(path): DCNL  DCSP image = None DCNL DCSP if is_url(path): DCNL DCSP  DCSP try: DCNL DCSP  DCSP  DCSP r = requests.get(path, allow_redirects=False, timeout=HTTP_TIMEOUT) DCNL DCSP  DCSP  DCSP r.raise_for_status() DCNL DCSP  DCSP  DCSP stream = StringIO(r.content) DCNL DCSP  DCSP  DCSP image = PIL.Image.open(stream) DCNL DCSP  DCSP except requests.exceptions.RequestException as e: DCNL DCSP  DCSP  DCSP raise errors.LoadImageError, e.message DCNL DCSP  DCSP except IOError as e: DCNL DCSP  DCSP  DCSP raise errors.LoadImageError, e.message DCNL DCSP elif os.path.exists(path): DCNL DCSP  DCSP try: DCNL DCSP  DCSP  DCSP image = PIL.Image.open(path) DCNL DCSP  DCSP  DCSP image.load() DCNL DCSP  DCSP except IOError as e: DCNL DCSP  DCSP  DCSP raise errors.LoadImageError, ('IOError: DCSP %s' % e.message) DCNL DCSP else: DCNL DCSP  DCSP raise errors.LoadImageError, ('"%s" DCSP not DCSP found' % path) DCNL DCSP if (image.mode in ['L', 'RGB']): DCNL DCSP  DCSP return image DCNL DCSP elif (image.mode in ['1']): DCNL DCSP  DCSP return image.convert('L') DCNL DCSP elif (image.mode in ['LA']): DCNL DCSP  DCSP new = PIL.Image.new('L', image.size, 255) DCNL DCSP  DCSP new.paste(image, mask=image.convert('RGBA')) DCNL DCSP  DCSP return new DCNL DCSP elif (image.mode in ['CMYK', 'YCbCr']): DCNL DCSP  DCSP return image.convert('RGB') DCNL DCSP elif (image.mode in ['P', 'RGBA']): DCNL DCSP  DCSP new = PIL.Image.new('RGB', image.size, (255, 255, 255)) DCNL DCSP  DCSP new.paste(image, mask=image.convert('RGBA')) DCNL DCSP  DCSP return new DCNL DCSP else: DCNL DCSP  DCSP raise errors.LoadImageError, ('Image DCSP mode DCSP "%s" DCSP not DCSP supported' % image.mode)
